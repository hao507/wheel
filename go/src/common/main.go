package main

import (
	"common/shmem"
	"unsafe"
	"fmt"
	"os"
	"time"
	"bufio"
	"bytes"
)

func main2() {
	switch os.Args[1] {
	case "read":
		read()
	case "write":
		write()
	}

}

func write() {
	s := shmem.NewSharedMemory()
	err := s.Open("aa", 1024, shmem.SHMEM_CREAT | shmem.SHMEM_RDWR)
	if err != nil {
		panic(err)
	}

	addr,err := s.Attach()
	if err != nil {
		panic(err)
	}

	slice := *makeByteSlice(addr, 1024, 1024)
	copy(slice, []byte("hello world"))
	fmt.Println("write:", string(slice))

	time.Sleep(5 * time.Second)

	s.Detach()
	s.Close()
}

func read() {
	s := shmem.NewSharedMemory()
	err := s.Open("aa", 1024, shmem.SHMEM_CREAT | shmem.SHMEM_RDWR)
	if err != nil {
		panic(err)
	}

	addr,err := s.Attach()
	if err != nil {
		panic(err)
	}

	slice := *makeByteSlice(addr, 1024, 1024)
	fmt.Println("read:", string(slice))

	time.Sleep(5 * time.Second)

	s.Detach()
	s.Close()
}

func makeByteSlice(addr uintptr, len, cap int) *[]byte {
	slice := struct {
		addr uintptr
		len  int
		cap  int
	} {addr:addr, len:len, cap:cap}

	return (*[]byte)(unsafe.Pointer(&slice))
}


const str = `{"@timestamp":"2019-01-04T07:50:42.356Z","@metadata":{"beat":"filebeat","type":"_doc","version":"7.0.0"},"message":"2019-01-04 15:50:42\tesPemowrnuhLwciCsEGPvtdWilUMLPfLvTdFsyKenuZgDniqdGDjRKRKSrMKMPGXlJkfzwfqDvvXbGBelAQlRqlLhsYkXWNjaExYyGJGxqXEqenngYFjVDAoWpSXkdTYEyZosbnorQhUxQcggLWMUwHiQQLRTwTvMWbZWKRDmjaMZPbdKkKNkfTwICZfbqsamnSdWtwCjeZnXEyywOuXQzyfPzWOzjukZTvFiUuxYrSVnysMEIDbzcbDghvwgeRqTSWijOOajVuvJcPACJWHpSEmiNBxIEPLTYfzkqlZsFzkMLyILJYgNDSsxqztrdNFeBgcoYCGDYjfyUblLZOEMYVneFGvMYKIhWyGTRUqJMxwaHkBvvzyaxJlAbxKxDUthdKkbsyhbZzyCubRmISxByHtACwTAeobmTjKbSSwlmwPzIKTIzlRzLtRlJonPWUnvjLIqRkSxqdKhHbnarqWIwTAfOyFoHHZKjnjgJweKoJvvklcJkWnnFTzUcTJtJmISehCJBCNxKibZTsWLdCuvTvRzDxEUtTVjZJfNqJIajlDsBwgBYvUfSxaJfPFOertHizvhipxocYXwXiQmyjmBFcNUsrwGDzUIFTJJIsMdoUZOYUmIfebXFyIiECfnzLzQlBBJaVYfkgfYWLNeTaWdSIgWnYWRjAZWfYlQufutJmOPQXueUsconPHwWOECZbSNJPFxzHRvcmxnmiKMKkDQAmqsNUeugonpDtESZJYllIewgKoblVzOZrJVAaZvtgFlYMbMEWnhyVCNqEEuxKdtkqiEUaDsYjYIWqUQQqclbPifNrBNOfKfNHBznxiOdCuINLGjVcBNUoKvhLJjuFkbwZEqCfhydfsYayRrJBFqzMcOyJMYehPSCXOCEhXLUnUrmRwPmxoTGbGVbIZhVTbWvdsAoyDGvPJJdEDrLjrkeMQdwzDGDldEByCeKmZAjuLTRkWNmWelRUjGGLOdqrSwZKfJqYJlEPzrRtnaKOXhfhyGZlMzJUinDDAUmUIdYUGKfduoqwXyBahzlVKYZJvHOvPiYSShtiPTVdQwETmHfQIZCTHwpBTznEqiuqRgfBWCtvKedwGUCeizybAAxtWRCIwFXSMSFSXTYWEnRAqxbrquUdbFkYSpbcNYPMfnbmuCGqtpHGRVVdLgkpRJWiOedDDBKeBbNWkqsDWQYdvwgjrshjKbGbwAOLmgemkzlvMDjWPvuUctUZlrTwvsRWRKjeevvoWLYMGnQbsefTQuBnFFeEviDhaeNlGbjsPbwqHhtyUPAJfFgsgBZlbIATTloKywAmyaqeTTLmbaqyJgJrqDyZuJvaIkSOGBNRekDoTVosQBvDbMWfYKzGTlRARChZCRKCBJtTJbCdueVqEWKdHurqyBkrXveBdSugyvusORBbqOYHbHRqQOXFhKFgSYnNiViLIheuoXgnnbTAVnMBojqysQIoGXUfdTRHQcTPVjwWyMYuxQEYddiQdwjUDGKwhTPoXALNMrjHerhsbFBaECLpebmVenIkyRyxROTFjoOceeRniyWVDOzktztbgDgqCtnUKFxrkhxnLZPgBLZkwLUEeELWhhJkraoXXBRpHHDdVktUZEngxrPIJJbEkNroMYAxVoOXjoiVVbjtJTkubACUBPPXdtYJdsZdatYsLYiBWpAvFJqqtMgwzCYQvZrboylIGuZtnnnKEvqEXdJIsaZaQcuirQYsTLNzfxtNgkHQDSIpcFbwPJJccVedsXCqyjSpadDyhoisEhjgwpvrooxjKAyVAdHXBstoxVmcrVTdXboEYdRWyhLWEnVnLcUvQpJLQDvQpvvTxqXDpXvVBQjvopoXYhzHdJTRAcFQWfYicXNQRIKdZQZycaWehUCMsrxCuifaPryFlstyvxRHDAcoINBYxRaraeLzjaRWyIMAFjnqlHrTXTlcJCXtjWtyDFmJcyrtfMpiDUETJjRUfuXtMWshqeLQpnzmklTCrVzLOqOhNXziBcvcykMVEeONOSoqQbxKkxYPyqXkEPmtZmdRgvhnkdfLVNdjQQVQiaLgmNETsZnKRqCzbpkEfaxNdLoFNUKeovXhVCFOMJWigwdDxmNAKkJVzUjEsLPFidWmrFqwwkCMjGPyxvyFEGHFenxZPfsGcpyJqPqqBmCfUvyCvAKDmCKVNXwoYXEAkJpeZOfNovYyUapoSzZhFoLdKPmNaSjiYslDDCQMmgLUzbpimealxLDPCjxXCpVYhlEQRxvTSCbxjqIuBcZMLlUEBGMNNXjzeOqQPUEHsUZGTbsNFSThZoPkupRklcHrwsqtItPpODYPkOpyHtmBMSazTsLTQhtOwCixWhRDDTxMIgKGRGtIjhaIYSXwUbyvaDDxbXcnxMyjApjqDOxTnOKwViaiExgPlbCUHCGKfssISbBCXGLIACCVCAVWpoCOyskNTkqBtOdmxnWQNnvDDrMcPIUYnzPjPWDgYeSCxzilDrnrtwaiEAdwVoGYvkTkocPlKFFEChLEUgZhMzIpIJIKONmMnSwgFSkQqANmccdqxvhWBzijuCzISRgWjsqAkfeXYdREvURoSGeDTkxuuIPbUKjYbECPIOFpFIAipVGDymtFNttZFCKGrbzzNFPkEFapCgkSLRPhfTgLJGbwrOxVerlzKOCakSkYbuAkhbwtblINweKfNqSUwqkLWUwEjWDqwrNLGJBICCrjdJnuktdoISvODhatFuJRppNvTRHFfnCcbouZKnsUEfYLJIhGiGeirFsgINVSTixkmrzrqVkbRUaLRtiOqMgcbbPQCrODCRIbTqePtyEMdYNXkITCmbTTZJlYxvWafiXaOVEQsdyYKNJCrWQLOVggfsXqPGtXGjaagYnszNeMMoHCxBvuZuwvsBhryEkGHPXKqOsIQTWXPlAtohGVrrSawqSrByQxhLgzdmEuQktRFMYiBaxJiOHdYhlSWhVxEDaQxtIsCaeUDAoiSCpcbeuSQvYbQpxcvjDEBkkOSYKsZZLbzYGfbdwBPlcMrHDOOunGSQNkWDFuQpDaaFymDMztwXhaTPjrhpJQpnEnCEciaANrpFzTVaDiflJBkbqgaBqoSQDhOnsDxmYlwRCRpuTnhTGwUHzEUjWCVZMimNcpJXeFTWroEJrkKTCbufNVgOEEVCVfZWQRKBNiUmqOBViZxsQSCTJhjpnltYKeUrdSiezugKisoGrYaiMeWZdygofYJZiWGZgEHPtizzpSRXOZChTXUlWuzkWMSPBqflJbiIryjJEXNrnUkETRfqCILuPJwzdqdyUczdHgbsHGPbHfdrlYkaSHLBfGBQPrLIvefhvHaRIncbYafkTPWMZiOOmnTRjbIGntFJSVuMOlfPmgdkZEmggOargPGkTPgBiDbRglcCvClYOqbzKyshVVqYiBSiPJHVHYLSXhrrERVxlCPzbFibyqnBJllzfhyalBiKFXQdgJvhdFHzczCHrKvtqXgWrwoRTvAIAKWOgcaTGrJfzkMnOSItmuQqACamMKPGJEpJawLZqoxsiYJkofSAkxeIgEpGXkmGKrgzccHUpCHefsEYhzntsExKwjqANAVpgFnwieFDGOgtOUFibJjTgUmzqSLnKGIxfpxrXOkXZjrygdBxPMoNlygJFJMksXbZwDMLhFwqEEDIbCOpGKRSvFeRZGojQSNtrolIpYjllDsxnOuaaucrLGCtgVlmmfFtXWONoNBcpoELnFqICOmirvzSxYqHiFlwoevjXOUIuxwRjQxEfYUdnBurYltXlFKReSwWIGQMWJhZZlDxWUzGlLaAKCRyHiqWGMcaFrRWyTERplgagxrvUFfqiJZqvHhqukpKeuSbGRfCctEGCcSVDWvqGPcTGkZyyKSwQodbIrWkBkkGrzyQmjUQdFDSNTVyqTVkcsvaxJqCiAJtHOhNfBBviRIINphRPPBbSVrdDNkbdTUEOHCHPDbgRgiXBTZsblWiDNRuoktzljhDxwxHufmSXATodnXNvueyjMXlHdHTWIlflZsjLWuTXhRRBsHKJJgaVZliyTcXbhrqDVhbtvIPgoyKvPQhXGNNaGHfRmadYEUUraNqUcaCVQExGxxnfRuKFWNfuSrufagtQzIuGkBDfjICMOeSsQCkeKvILwbMLJNoUYoSMASqwiBiDMtIWLVaoGsICzJuhvmNgXAGLKuSlAtfxbEGEpWkMMupoyTuvWlRgMxRkPevuVTfhvSlxugvmtzRprNnVGZmFLWXpKyvVGUHvKYEftdCxhYLWerhspWMQVVYjPkFWfUUBXzSJCvszVqnLkfzKQBFqQRQJKTaMBSovPpwOnWZyHDwqaMNeYLfJrJkOREyeslRYzWGzgPdUbxVRDQHnHfXuZBrhQxlqUexEnLelgLrRWPgwFpkzUVnOruGyYrIOMhtDQoQKVPwaHmMghOhZHxIIcEoXszmmmeoMwFFbwWxEWZkoqiCSJUuyqhjCxYrnLkzAjJtCvZqFSbmLfXWzWCuGHOWftuNmxTnxNPiasPgFKjCOguWSbCPpnFWjLPtEOyhukIykGYwoJfdZCeNGOVHYfcyYcElozQKEIwwyXJEyUKkWROHuGHLvcesxXIwBiXeQWezXlsQKQGusHpSAjtCjYaAjEVILusvwgyPUVQaJPupUSvnFeCQZDXzJUmvwtgpnFWDcacDeTVQjxMGGhIFytcLNKgXBgtLkmLzmiweGgPSSDXKHDebsHeBmDLnWmXAuhZorgLEzNwRwlzKyacxomLZyXvhasBAqQHGWIQfKQZdmGpWyoRJKUuEgMkTEGaqGeluKiDQLnKVOwYqVMwWDrsksJcaTtOfaNIPCgLpLqNnEymuWiSSXoNNskxkjbNMCKtIoLWIUvcEiDPjYMGJAIwQmNeHBhLpxYAETLxnwBNnEuLVjKniZppZWJxNdCghWldboUUinYluprsgTKADsgwMKPgnPsDNPLucgdvctDTuLyLIMvcBqhZdplxDMoVUUDsvYxQvnugnyIuHQxzZxZBRvgewwRNlsHvzOXkWiLdSppWPrRUiyCZyZpIAkPRpalFFlVPIGBDDuSPAoauuvgtVOjjmJqqCIYlDmtzGQRVmwwuHtmiHPNrIlSXAtVQkflZNegbozOK","log":{"offset":3505858681,"file":{"path":"/xxy/mq7"}},"input":{"type":"log"},"agent":{"version":"7.0.0","type":"filebeat","hostname":"xxy1"},"host":{"name":"xxy1"}}
{"@timestamp":"2019-01-04T07:50:42.356Z","@metadata":{"beat":"filebeat","type":"_doc","version":"7.0.0"},"message":"2019-01-04 15:50:42\tesPemowrnuhLwciCsEGPvtdWilUMLPfLvTdFsyKenuZgDniqdGDjRKRKSrMKMPGXlJkfzwfqDvvXbGBelAQlRqlLhsYkXWNjaExYyGJGxqXEqenngYFjVDAoWpSXkdTYEyZosbnorQhUxQcggLWMUwHiQQLRTwTvMWbZWKRDmjaMZPbdKkKNkfTwICZfbqsamnSdWtwCjeZnXEyywOuXQzyfPzWOzjukZTvFiUuxYrSVnysMEIDbzcbDghvwgeRqTSWijOOajVuvJcPACJWHpSEmiNBxIEPLTYfzkqlZsFzkMLyILJYgNDSsxqztrdNFeBgcoYCGDYjfyUblLZOEMYVneFGvMYKIhWyGTRUqJMxwaHkBvvzyaxJlAbxKxDUthdKkbsyhbZzyCubRmISxByHtACwTAeobmTjKbSSwlmwPzIKTIzlRzLtRlJonPWUnvjLIqRkSxqdKhHbnarqWIwTAfOyFoHHZKjnjgJweKoJvvklcJkWnnFTzUcTJtJmISehCJBCNxKibZTsWLdCuvTvRzDxEUtTVjZJfNqJIajlDsBwgBYvUfSxaJfPFOertHizvhipxocYXwXiQmyjmBFcNUsrwGDzUIFTJJIsMdoUZOYUmIfebXFyIiECfnzLzQlBBJaVYfkgfYWLNeTaWdSIgWnYWRjAZWfYlQufutJmOPQXueUsconPHwWOECZbSNJPFxzHRvcmxnmiKMKkDQAmqsNUeugonpDtESZJYllIewgKoblVzOZrJVAaZvtgFlYMbMEWnhyVCNqEEuxKdtkqiEUaDsYjYIWqUQQqclbPifNrBNOfKfNHBznxiOdCuINLGjVcBNUoKvhLJjuFkbwZEqCfhydfsYayRrJBFqzMcOyJMYehPSCXOCEhXLUnUrmRwPmxoTGbGVbIZhVTbWvdsAoyDGvPJJdEDrLjrkeMQdwzDGDldEByCeKmZAjuLTRkWNmWelRUjGGLOdqrSwZKfJqYJlEPzrRtnaKOXhfhyGZlMzJUinDDAUmUIdYUGKfduoqwXyBahzlVKYZJvHOvPiYSShtiPTVdQwETmHfQIZCTHwpBTznEqiuqRgfBWCtvKedwGUCeizybAAxtWRCIwFXSMSFSXTYWEnRAqxbrquUdbFkYSpbcNYPMfnbmuCGqtpHGRVVdLgkpRJWiOedDDBKeBbNWkqsDWQYdvwgjrshjKbGbwAOLmgemkzlvMDjWPvuUctUZlrTwvsRWRKjeevvoWLYMGnQbsefTQuBnFFeEviDhaeNlGbjsPbwqHhtyUPAJfFgsgBZlbIATTloKywAmyaqeTTLmbaqyJgJrqDyZuJvaIkSOGBNRekDoTVosQBvDbMWfYKzGTlRARChZCRKCBJtTJbCdueVqEWKdHurqyBkrXveBdSugyvusORBbqOYHbHRqQOXFhKFgSYnNiViLIheuoXgnnbTAVnMBojqysQIoGXUfdTRHQcTPVjwWyMYuxQEYddiQdwjUDGKwhTPoXALNMrjHerhsbFBaECLpebmVenIkyRyxROTFjoOceeRniyWVDOzktztbgDgqCtnUKFxrkhxnLZPgBLZkwLUEeELWhhJkraoXXBRpHHDdVktUZEngxrPIJJbEkNroMYAxVoOXjoiVVbjtJTkubACUBPPXdtYJdsZdatYsLYiBWpAvFJqqtMgwzCYQvZrboylIGuZtnnnKEvqEXdJIsaZaQcuirQYsTLNzfxtNgkHQDSIpcFbwPJJccVedsXCqyjSpadDyhoisEhjgwpvrooxjKAyVAdHXBstoxVmcrVTdXboEYdRWyhLWEnVnLcUvQpJLQDvQpvvTxqXDpXvVBQjvopoXYhzHdJTRAcFQWfYicXNQRIKdZQZycaWehUCMsrxCuifaPryFlstyvxRHDAcoINBYxRaraeLzjaRWyIMAFjnqlHrTXTlcJCXtjWtyDFmJcyrtfMpiDUETJjRUfuXtMWshqeLQpnzmklTCrVzLOqOhNXziBcvcykMVEeONOSoqQbxKkxYPyqXkEPmtZmdRgvhnkdfLVNdjQQVQiaLgmNETsZnKRqCzbpkEfaxNdLoFNUKeovXhVCFOMJWigwdDxmNAKkJVzUjEsLPFidWmrFqwwkCMjGPyxvyFEGHFenxZPfsGcpyJqPqqBmCfUvyCvAKDmCKVNXwoYXEAkJpeZOfNovYyUapoSzZhFoLdKPmNaSjiYslDDCQMmgLUzbpimealxLDPCjxXCpVYhlEQRxvTSCbxjqIuBcZMLlUEBGMNNXjzeOqQPUEHsUZGTbsNFSThZoPkupRklcHrwsqtItPpODYPkOpyHtmBMSazTsLTQhtOwCixWhRDDTxMIgKGRGtIjhaIYSXwUbyvaDDxbXcnxMyjApjqDOxTnOKwViaiExgPlbCUHCGKfssISbBCXGLIACCVCAVWpoCOyskNTkqBtOdmxnWQNnvDDrMcPIUYnzPjPWDgYeSCxzilDrnrtwaiEAdwVoGYvkTkocPlKFFEChLEUgZhMzIpIJIKONmMnSwgFSkQqANmccdqxvhWBzijuCzISRgWjsqAkfeXYdREvURoSGeDTkxuuIPbUKjYbECPIOFpFIAipVGDymtFNttZFCKGrbzzNFPkEFapCgkSLRPhfTgLJGbwrOxVerlzKOCakSkYbuAkhbwtblINweKfNqSUwqkLWUwEjWDqwrNLGJBICCrjdJnuktdoISvODhatFuJRppNvTRHFfnCcbouZKnsUEfYLJIhGiGeirFsgINVSTixkmrzrqVkbRUaLRtiOqMgcbbPQCrODCRIbTqePtyEMdYNXkITCmbTTZJlYxvWafiXaOVEQsdyYKNJCrWQLOVggfsXqPGtXGjaagYnszNeMMoHCxBvuZuwvsBhryEkGHPXKqOsIQTWXPlAtohGVrrSawqSrByQxhLgzdmEuQktRFMYiBaxJiOHdYhlSWhVxEDaQxtIsCaeUDAoiSCpcbeuSQvYbQpxcvjDEBkkOSYKsZZLbzYGfbdwBPlcMrHDOOunGSQNkWDFuQpDaaFymDMztwXhaTPjrhpJQpnEnCEciaANrpFzTVaDiflJBkbqgaBqoSQDhOnsDxmYlwRCRpuTnhTGwUHzEUjWCVZMimNcpJXeFTWroEJrkKTCbufNVgOEEVCVfZWQRKBNiUmqOBViZxsQSCTJhjpnltYKeUrdSiezugKisoGrYaiMeWZdygofYJZiWGZgEHPtizzpSRXOZChTXUlWuzkWMSPBqflJbiIryjJEXNrnUkETRfqCILuPJwzdqdyUczdHgbsHGPbHfdrlYkaSHLBfGBQPrLIvefhvHaRIncbYafkTPWMZiOOmnTRjbIGntFJSVuMOlfPmgdkZEmggOargPGkTPgBiDbRglcCvClYOqbzKyshVVqYiBSiPJHVHYLSXhrrERVxlCPzbFibyqnBJllzfhyalBiKFXQdgJvhdFHzczCHrKvtqXgWrwoRTvAIAKWOgcaTGrJfzkMnOSItmuQqACamMKPGJEpJawLZqoxsiYJkofSAkxeIgEpGXkmGKrgzccHUpCHefsEYhzntsExKwjqANAVpgFnwieFDGOgtOUFibJjTgUmzqSLnKGIxfpxrXOkXZjrygdBxPMoNlygJFJMksXbZwDMLhFwqEEDIbCOpGKRSvFeRZGojQSNtrolIpYjllDsxnOuaaucrLGCtgVlmmfFtXWONoNBcpoELnFqICOmirvzSxYqHiFlwoevjXOUIuxwRjQxEfYUdnBurYltXlFKReSwWIGQMWJhZZlDxWUzGlLaAKCRyHiqWGMcaFrRWyTERplgagxrvUFfqiJZqvHhqukpKeuSbGRfCctEGCcSVDWvqGPcTGkZyyKSwQodbIrWkBkkGrzyQmjUQdFDSNTVyqTVkcsvaxJqCiAJtHOhNfBBviRIINphRPPBbSVrdDNkbdTUEOHCHPDbgRgiXBTZsblWiDNRuoktzljhDxwxHufmSXATodnXNvueyjMXlHdHTWIlflZsjLWuTXhRRBsHKJJgaVZliyTcXbhrqDVhbtvIPgoyKvPQhXGNNaGHfRmadYEUUraNqUcaCVQExGxxnfRuKFWNfuSrufagtQzIuGkBDfjICMOeSsQCkeKvILwbMLJNoUYoSMASqwiBiDMtIWLVaoGsICzJuhvmNgXAGLKuSlAtfxbEGEpWkMMupoyTuvWlRgMxRkPevuVTfhvSlxugvmtzRprNnVGZmFLWXpKyvVGUHvKYEftdCxhYLWerhspWMQVVYjPkFWfUUBXzSJCvszVqnLkfzKQBFqQRQJKTaMBSovPpwOnWZyHDwqaMNeYLfJrJkOREyeslRYzWGzgPdUbxVRDQHnHfXuZBrhQxlqUexEnLelgLrRWPgwFpkzUVnOruGyYrIOMhtDQoQKVPwaHmMghOhZHxIIcEoXszmmmeoMwFFbwWxEWZkoqiCSJUuyqhjCxYrnLkzAjJtCvZqFSbmLfXWzWCuGHOWftuNmxTnxNPiasPgFKjCOguWSbCPpnFWjLPtEOyhukIykGYwoJfdZCeNGOVHYfcyYcElozQKEIwwyXJEyUKkWROHuGHLvcesxXIwBiXeQWezXlsQKQGusHpSAjtCjYaAjEVILusvwgyPUVQaJPupUSvnFeCQZDXzJUmvwtgpnFWDcacDeTVQjxMGGhIFytcLNKgXBgtLkmLzmiweGgPSSDXKHDebsHeBmDLnWmXAuhZorgLEzNwRwlzKyacxomLZyXvhasBAqQHGWIQfKQZdmGpWyoRJKUuEgMkTEGaqGeluKiDQLnKVOwYqVMwWDrsksJcaTtOfaNIPCgLpLqNnEymuWiSSXoNNskxkjbNMCKtIoLWIUvcEiDPjYMGJAIwQmNeHBhLpxYAETLxnwBNnEuLVjKniZppZWJxNdCghWldboUUinYluprsgTKADsgwMKPgnPsDNPLucgdvctDTuLyLIMvcBqhZdplxDMoVUUDsvYxQvnugnyIuHQxzZxZBRvgewwRNlsHvzOXkWiLdSppWPrRUiyCZyZpIAkPRpalFFlVPIGBDDuSPAoauuvgtVOjjmJqqCIYlDmtzGQRVmwwuHtmiHPNrIlSXAtVQkflZNegbozOK","log":{"offset":3505858681,"file":{"path":"/xxy/mq7"}},"input":{"type":"log"},"agent":{"version":"7.0.0","type":"filebeat","hostname":"xxy1"},"host":{"name":"xxy1"}}
{"@timestamp":"2019-01-04T07:50:42.356Z","@metadata":{"beat":"filebeat","type":"_doc","version":"7.0.0"},"message":"2019-01-04 15:50:42\tesPemowrnuhLwciCsEGPvtdWilUMLPfLvTdFsyKenuZgDniqdGDjRKRKSrMKMPGXlJkfzwfqDvvXbGBelAQlRqlLhsYkXWNjaExYyGJGxqXEqenngYFjVDAoWpSXkdTYEyZosbnorQhUxQcggLWMUwHiQQLRTwTvMWbZWKRDmjaMZPbdKkKNkfTwICZfbqsamnSdWtwCjeZnXEyywOuXQzyfPzWOzjukZTvFiUuxYrSVnysMEIDbzcbDghvwgeRqTSWijOOajVuvJcPACJWHpSEmiNBxIEPLTYfzkqlZsFzkMLyILJYgNDSsxqztrdNFeBgcoYCGDYjfyUblLZOEMYVneFGvMYKIhWyGTRUqJMxwaHkBvvzyaxJlAbxKxDUthdKkbsyhbZzyCubRmISxByHtACwTAeobmTjKbSSwlmwPzIKTIzlRzLtRlJonPWUnvjLIqRkSxqdKhHbnarqWIwTAfOyFoHHZKjnjgJweKoJvvklcJkWnnFTzUcTJtJmISehCJBCNxKibZTsWLdCuvTvRzDxEUtTVjZJfNqJIajlDsBwgBYvUfSxaJfPFOertHizvhipxocYXwXiQmyjmBFcNUsrwGDzUIFTJJIsMdoUZOYUmIfebXFyIiECfnzLzQlBBJaVYfkgfYWLNeTaWdSIgWnYWRjAZWfYlQufutJmOPQXueUsconPHwWOECZbSNJPFxzHRvcmxnmiKMKkDQAmqsNUeugonpDtESZJYllIewgKoblVzOZrJVAaZvtgFlYMbMEWnhyVCNqEEuxKdtkqiEUaDsYjYIWqUQQqclbPifNrBNOfKfNHBznxiOdCuINLGjVcBNUoKvhLJjuFkbwZEqCfhydfsYayRrJBFqzMcOyJMYehPSCXOCEhXLUnUrmRwPmxoTGbGVbIZhVTbWvdsAoyDGvPJJdEDrLjrkeMQdwzDGDldEByCeKmZAjuLTRkWNmWelRUjGGLOdqrSwZKfJqYJlEPzrRtnaKOXhfhyGZlMzJUinDDAUmUIdYUGKfduoqwXyBahzlVKYZJvHOvPiYSShtiPTVdQwETmHfQIZCTHwpBTznEqiuqRgfBWCtvKedwGUCeizybAAxtWRCIwFXSMSFSXTYWEnRAqxbrquUdbFkYSpbcNYPMfnbmuCGqtpHGRVVdLgkpRJWiOedDDBKeBbNWkqsDWQYdvwgjrshjKbGbwAOLmgemkzlvMDjWPvuUctUZlrTwvsRWRKjeevvoWLYMGnQbsefTQuBnFFeEviDhaeNlGbjsPbwqHhtyUPAJfFgsgBZlbIATTloKywAmyaqeTTLmbaqyJgJrqDyZuJvaIkSOGBNRekDoTVosQBvDbMWfYKzGTlRARChZCRKCBJtTJbCdueVqEWKdHurqyBkrXveBdSugyvusORBbqOYHbHRqQOXFhKFgSYnNiViLIheuoXgnnbTAVnMBojqysQIoGXUfdTRHQcTPVjwWyMYuxQEYddiQdwjUDGKwhTPoXALNMrjHerhsbFBaECLpebmVenIkyRyxROTFjoOceeRniyWVDOzktztbgDgqCtnUKFxrkhxnLZPgBLZkwLUEeELWhhJkraoXXBRpHHDdVktUZEngxrPIJJbEkNroMYAxVoOXjoiVVbjtJTkubACUBPPXdtYJdsZdatYsLYiBWpAvFJqqtMgwzCYQvZrboylIGuZtnnnKEvqEXdJIsaZaQcuirQYsTLNzfxtNgkHQDSIpcFbwPJJccVedsXCqyjSpadDyhoisEhjgwpvrooxjKAyVAdHXBstoxVmcrVTdXboEYdRWyhLWEnVnLcUvQpJLQDvQpvvTxqXDpXvVBQjvopoXYhzHdJTRAcFQWfYicXNQRIKdZQZycaWehUCMsrxCuifaPryFlstyvxRHDAcoINBYxRaraeLzjaRWyIMAFjnqlHrTXTlcJCXtjWtyDFmJcyrtfMpiDUETJjRUfuXtMWshqeLQpnzmklTCrVzLOqOhNXziBcvcykMVEeONOSoqQbxKkxYPyqXkEPmtZmdRgvhnkdfLVNdjQQVQiaLgmNETsZnKRqCzbpkEfaxNdLoFNUKeovXhVCFOMJWigwdDxmNAKkJVzUjEsLPFidWmrFqwwkCMjGPyxvyFEGHFenxZPfsGcpyJqPqqBmCfUvyCvAKDmCKVNXwoYXEAkJpeZOfNovYyUapoSzZhFoLdKPmNaSjiYslDDCQMmgLUzbpimealxLDPCjxXCpVYhlEQRxvTSCbxjqIuBcZMLlUEBGMNNXjzeOqQPUEHsUZGTbsNFSThZoPkupRklcHrwsqtItPpODYPkOpyHtmBMSazTsLTQhtOwCixWhRDDTxMIgKGRGtIjhaIYSXwUbyvaDDxbXcnxMyjApjqDOxTnOKwViaiExgPlbCUHCGKfssISbBCXGLIACCVCAVWpoCOyskNTkqBtOdmxnWQNnvDDrMcPIUYnzPjPWDgYeSCxzilDrnrtwaiEAdwVoGYvkTkocPlKFFEChLEUgZhMzIpIJIKONmMnSwgFSkQqANmccdqxvhWBzijuCzISRgWjsqAkfeXYdREvURoSGeDTkxuuIPbUKjYbECPIOFpFIAipVGDymtFNttZFCKGrbzzNFPkEFapCgkSLRPhfTgLJGbwrOxVerlzKOCakSkYbuAkhbwtblINweKfNqSUwqkLWUwEjWDqwrNLGJBICCrjdJnuktdoISvODhatFuJRppNvTRHFfnCcbouZKnsUEfYLJIhGiGeirFsgINVSTixkmrzrqVkbRUaLRtiOqMgcbbPQCrODCRIbTqePtyEMdYNXkITCmbTTZJlYxvWafiXaOVEQsdyYKNJCrWQLOVggfsXqPGtXGjaagYnszNeMMoHCxBvuZuwvsBhryEkGHPXKqOsIQTWXPlAtohGVrrSawqSrByQxhLgzdmEuQktRFMYiBaxJiOHdYhlSWhVxEDaQxtIsCaeUDAoiSCpcbeuSQvYbQpxcvjDEBkkOSYKsZZLbzYGfbdwBPlcMrHDOOunGSQNkWDFuQpDaaFymDMztwXhaTPjrhpJQpnEnCEciaANrpFzTVaDiflJBkbqgaBqoSQDhOnsDxmYlwRCRpuTnhTGwUHzEUjWCVZMimNcpJXeFTWroEJrkKTCbufNVgOEEVCVfZWQRKBNiUmqOBViZxsQSCTJhjpnltYKeUrdSiezugKisoGrYaiMeWZdygofYJZiWGZgEHPtizzpSRXOZChTXUlWuzkWMSPBqflJbiIryjJEXNrnUkETRfqCILuPJwzdqdyUczdHgbsHGPbHfdrlYkaSHLBfGBQPrLIvefhvHaRIncbYafkTPWMZiOOmnTRjbIGntFJSVuMOlfPmgdkZEmggOargPGkTPgBiDbRglcCvClYOqbzKyshVVqYiBSiPJHVHYLSXhrrERVxlCPzbFibyqnBJllzfhyalBiKFXQdgJvhdFHzczCHrKvtqXgWrwoRTvAIAKWOgcaTGrJfzkMnOSItmuQqACamMKPGJEpJawLZqoxsiYJkofSAkxeIgEpGXkmGKrgzccHUpCHefsEYhzntsExKwjqANAVpgFnwieFDGOgtOUFibJjTgUmzqSLnKGIxfpxrXOkXZjrygdBxPMoNlygJFJMksXbZwDMLhFwqEEDIbCOpGKRSvFeRZGojQSNtrolIpYjllDsxnOuaaucrLGCtgVlmmfFtXWONoNBcpoELnFqICOmirvzSxYqHiFlwoevjXOUIuxwRjQxEfYUdnBurYltXlFKReSwWIGQMWJhZZlDxWUzGlLaAKCRyHiqWGMcaFrRWyTERplgagxrvUFfqiJZqvHhqukpKeuSbGRfCctEGCcSVDWvqGPcTGkZyyKSwQodbIrWkBkkGrzyQmjUQdFDSNTVyqTVkcsvaxJqCiAJtHOhNfBBviRIINphRPPBbSVrdDNkbdTUEOHCHPDbgRgiXBTZsblWiDNRuoktzljhDxwxHufmSXATodnXNvueyjMXlHdHTWIlflZsjLWuTXhRRBsHKJJgaVZliyTcXbhrqDVhbtvIPgoyKvPQhXGNNaGHfRmadYEUUraNqUcaCVQExGxxnfRuKFWNfuSrufagtQzIuGkBDfjICMOeSsQCkeKvILwbMLJNoUYoSMASqwiBiDMtIWLVaoGsICzJuhvmNgXAGLKuSlAtfxbEGEpWkMMupoyTuvWlRgMxRkPevuVTfhvSlxugvmtzRprNnVGZmFLWXpKyvVGUHvKYEftdCxhYLWerhspWMQVVYjPkFWfUUBXzSJCvszVqnLkfzKQBFqQRQJKTaMBSovPpwOnWZyHDwqaMNeYLfJrJkOREyeslRYzWGzgPdUbxVRDQHnHfXuZBrhQxlqUexEnLelgLrRWPgwFpkzUVnOruGyYrIOMhtDQoQKVPwaHmMghOhZHxIIcEoXszmmmeoMwFFbwWxEWZkoqiCSJUuyqhjCxYrnLkzAjJtCvZqFSbmLfXWzWCuGHOWftuNmxTnxNPiasPgFKjCOguWSbCPpnFWjLPtEOyhukIykGYwoJfdZCeNGOVHYfcyYcElozQKEIwwyXJEyUKkWROHuGHLvcesxXIwBiXeQWezXlsQKQGusHpSAjtCjYaAjEVILusvwgyPUVQaJPupUSvnFeCQZDXzJUmvwtgpnFWDcacDeTVQjxMGGhIFytcLNKgXBgtLkmLzmiweGgPSSDXKHDebsHeBmDLnWmXAuhZorgLEzNwRwlzKyacxomLZyXvhasBAqQHGWIQfKQZdmGpWyoRJKUuEgMkTEGaqGeluKiDQLnKVOwYqVMwWDrsksJcaTtOfaNIPCgLpLqNnEymuWiSSXoNNskxkjbNMCKtIoLWIUvcEiDPjYMGJAIwQmNeHBhLpxYAETLxnwBNnEuLVjKniZppZWJxNdCghWldboUUinYluprsgTKADsgwMKPgnPsDNPLucgdvctDTuLyLIMvcBqhZdplxDMoVUUDsvYxQvnugnyIuHQxzZxZBRvgewwRNlsHvzOXkWiLdSppWPrRUiyCZyZpIAkPRpalFFlVPIGBDDuSPAoauuvgtVOjjmJqqCIYlDmtzGQRVmwwuHtmiHPNrIlSXAtVQkflZNegbozOK","log":{"offset":3505858681,"file":{"path":"/xxy/mq7"}},"input":{"type":"log"},"agent":{"version":"7.0.0","type":"filebeat","hostname":"xxy1"},"host":{"name":"xxy1"}}`
func main() {
	reader := bufio.NewReaderSize(bytes.NewReader([]byte(str)), 1024 * 128)
	line,_,err := reader.ReadLine()
	if err != nil {
		panic(err)
	}
	fmt.Println("len:", len(line))
	fmt.Println(string(line))
}